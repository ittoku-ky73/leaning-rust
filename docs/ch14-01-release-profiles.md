# リリースプロファイル

> Ref: https://doc.rust-jp.rs/book-ja/ch14-01-release-profiles.html

Rustにおいてリリースプロファイルとは、プログラマがコードのコンパイルオプションについて制御可能にしてくれる、定義済みのカスタマイズ可能なプロファイルです。
各プロファイルはそれぞれ独立して設定されています。

Cargoには主に2つのプロファイルがあります。
`dev`プロファイルは`cargo build`を実行した時に使用され、`release`プロファイルは`cargo build --release`を実行した時に使用されます。
`dev`プロファイルは開発中に役立つデフォルトの設定がされており、`release`プロファイルはリリース用の設定がされています。

これらのプロファイル名は、ビルドの出力で馴染みがあるかもしれません。

```bash
$ cargo build
    Finished dev [unoptimized + debuginfo] target(s) in 0.0 secs
$ cargo build --release
    Finished release [optimized] target(s) in 0.0 secs
```

このビルド出力で表示されている`dev, release`は、コンパイラが異なるプロファイルを使用していることを示しています。

`Cargo.toml`ファイルに`[profile.*]`セクションが存在しない際に適用される各プロファイル用のデフォルト設定が、Cargoには存在します。
カスタマイズしたいプロファイル用の`[profile.*]`セクションを追加することで、デフォルト設定の一部を上書きすることができます。

```toml
[profile.dev]
opt-level = 0

[profile.release]
opt-level = 3
```

`opt-level`設定は、0から3の範囲でコンパイラがコードに適用する最適化の度合いを制御します。
最適化を多くかけるとコンパイル時間が伸びます。
開発中に頻繁にコードをコンパイルするのなら、たとえ出力結果のコードの動作速度が遅くなっても早くコンパイルが済んでほしいです。
これが`dev`の`opt-level`のデフォルト設定が0担っている理由です。
コードのリリース準備ができたら、より長い時間をコンパイルにかけるのが最残の策です。
リリースモードでコンパイルするのはたった1回ですが、コンパイル結果のプログラムは何度も実行されます。
リリースモードでは長いコンパイル時間と引き換えに、生成したコードが速く動作します。
そのため`release`の`opt-level`のデフォルト設定が3になっているのです。

デフォルト設定に対して`Cargo.toml`で異なる値を追加すれば、上書きすることができます。

```toml
[profile.dev]
opt-level = 1
```

このコードはデフォルト設定の0を上書きします。
こうすると`cargo build`を実行した時に、`dev`プロファイル用のデフォルト設定に加えて、Cargoは`opt-level`の変更を適用します。
`opt-level`を1に設定したので、Cargoはデフォルトよりは最適化を行いますが、リリースビルド程ではありません。

設定の選択肢と各プロファイルのデフォルト設定の一覧は、[Cargoドキュメント](https://doc.rust-lang.org/cargo)で確認できます。 
